---

title: grep的用法
tags:
- grep
categories:
- shell
---

# 1.常用参数解析

1. 正则表达式引擎

   | 参数 | 说明                       |
   | ---- | -------------------------- |
   | -E   | POSIX扩展正则表达式（ERE） |
   | -G   | POSIX基本正则表达式（BRE） |
   | -P   | Perl正则表达式（PCRE）     |

   默认情况下grep使用的是-G，也就是基本正则表达式，在基本正则中，像+和？等这些元字符都是普通文字字符，如果需要使用这些元字符的特殊意义，就需要用到扩展的正则表达式。

2. 元字符

   |         **基本元字符**          | **功能**                   | **示例**                             | **匹配对象**                                                 |
   | :-----------------------------: | :------------------------- | :----------------------------------- | :----------------------------------------------------------- |
   |                ^                | 行首定位符                 | ’^hello‘                             | 匹配所有以hello开头的行                                      |
   |                $                | 行尾定位符                 | ‘hello$’                             | 匹配所有以hello结尾的行                                      |
   |                .                | 匹配任意一个字符           | ’h.l‘                                | 匹配包含一个h字符，后面跟一个字符（随意），再跟一个l的行     |
   |                *                | 匹配0或多个前一字符        | ’h*l‘                                | 匹配包含零个或多个h字符，后面跟有一个l字符的行               |
   |               []                | 匹配一组字符中的任意一个   | ’[Hh]ello‘                           | 匹配hello，或者Hello                                         |
   |               [^]               | 匹配不在指定字符组内的字符 | ’\[^a-z]ello‘                        | 匹配不包含在a-z之间的字符后跟着ello的行                      |
   |               \\<               | 词首定位符                 | \'\<hello'                           | 匹配以hello为开头的词的行，helloabcd也是可以的               |
   |               \\>               | 词尾定位符                 | 'hello\\>'                           | 匹配以hello为结尾的词的行，abcdhello也是可以的               |
   |            \\(..\\)             | 标记匹配的字符             | ''\\(hello\\)'s blog'                | 标记寄存器里的一段字符，该寄存器被记作1号寄存器。以后引用这段字符时，可以使用\1来重复该模式。9个标签中最左边的是第一号。例如，模式hello被保存在1号寄存器里，之后用\1来引用它。 |
   | x\\{m\\}或x\\{m,\\}或x\\{m,n\\} | 字符x的重复出现            | 's\\{5\\}’,'s\\{5,\\}’,'s\\{5,10\\}’ | 匹配连续出现5个s、至少5个s或5到10个s的行                     |

   以上基本元字符中的一些注意使用反斜杠，否则在不使用扩展正则的情况下，都会被认为是普通字符。

   | **扩展元字符** | **功能**                 | **示例**  | **匹配对象**                                        |
   | :------------: | :----------------------- | :-------- | :-------------------------------------------------- |
   |       +        | 匹配一个或多个前导字符   | 'h+x'     | 匹配一个或者多个h字符后面跟着x的行                  |
   |       ?        | 匹配零个或一个前导字符   | 'h?x'     | 匹配包含零个或者多个h，后面跟着x的行                |
   |       \|       | 匹配a或b                 | 'a\|b'    | 匹配包含a或者b的行                                  |
   |       ()       | 组字符                   | 'h(a\|b)' | 匹配包含ha或者hb的行                                |
   |       \w       | 所有字母与数字           | 'x\w*ve'  | 匹配x后面跟着零个或者多个数字或者字符，以ve结尾的行 |
   |       \W       | 所有字母与数字之外的字符 | ‘x\W+’    | 匹配x后面跟着一个或者多个非字符的行                 |
   |       \b       | 词边界                   | 'xh\b'    | 以xh为结尾的行                                      |

   扩展元字符是指在扩展正则表达式里面使用的。

   注意：将正则表示式使用单引号括起来，以避免shell解释和扩展元字符的误操作。

3. 常用参数

   | 参数         | 说明                                                         |
   | :----------- | :----------------------------------------------------------- |
   | -b           | 将二进制文件作为文本来进行匹配                               |
   | -c           | 统计以模式匹配的条数                                         |
   | -i           | 忽略大小写                                                   |
   | -n           | 显示匹配文本所在行的行号                                     |
   | -v           | 反选，输出不匹配行的内容                                     |
   | -r           | 递归匹配查找                                                 |
   | -A n         | n为正整数，表示after的意思，除了列出匹配行之外，还列出后面的n行 |
   | -B n         | n为正整数，表示before的意思，除了列出匹配行之外，还列出前面的n行 |
   | --color=auto | 将输出中的匹配项设置为自动颜色显示                           |

   以上参数是常用的一些参数，需要牢记。

# 2.举例说明

~~~shell
#查找/etc/group文件中以"shiyanlou"为开头的行
$ grep 'shiyanlou' /etc/group
$ grep '^shiyanlou' /etc/group
# 将匹配以'z'开头以'o'结尾的所有字符串
$ echo 'zero\nzo\nzoo' | grep 'z.*o'
# 将匹配以'z'开头以'o'结尾，中间包含一个任意字符的字符串
$ echo 'zero\nzo\nzoo' | grep 'z.o'
# 将匹配以'z'开头,以任意多个'o'结尾的字符串
$ echo 'zero\nzo\nzoo' | grep 'zo*'
# grep默认是区分大小写的，这里将匹配所有的小写字母
$ echo '1234\nabcd' | grep '[a-z]'
# 将匹配所有的数字
$ echo '1234\nabcd' | grep '[0-9]'
# 将匹配所有的数字
$ echo '1234\nabcd' | grep '[[:digit:]]'
# 将匹配所有的小写字母
$ echo '1234\nabcd' | grep '[[:lower:]]'
# 将匹配所有的大写字母
$ echo '1234\nabcd' | grep '[[:upper:]]'
# 将匹配所有的字母和数字，包括0-9,a-z,A-Z
$ echo '1234\nabcd' | grep '[[:alnum:]]'
# 将匹配所有的字母
$ echo '1234\nabcd' | grep '[[:alpha:]]'
# 匹配除o之外的字符
$ echo 'geek\ngood' | grep '[^o]'
# 只匹配"zo"
$ echo 'zero\nzo\nzoo' | grep -E 'zo{1}'
# 匹配以"zo"开头的所有单词
$ echo 'zero\nzo\nzoo' | grep -E 'zo{1,}'
# 匹配"www.shiyanlou.com"和"www.google.com" 
$ echo 'www.shiyanlou.com\nwww.baidu.com\nwww.google.com' | grep -E 'www\.(shiyanlou|google)\.com' 
# 匹配不包含"baidu"的内容 
$ echo 'www.shiyanlou.com\nwww.baidu.com\nwww.google.com' | grep -Ev 'www\.baidu\.com'
~~~

# 3.零宽断言

定义：匹配宽度为零，满足一定的条件（断言）。

目的：用于查找在某些内容之前或者之后，但是不包含它本身的东西。

使用方法：需要使用-P参数。

1. 先行断言

   ~~~shell
   $ cat test
   hello solo
   world
   love
   polo
   $ grep -Po '[a-z]*(?=lo)' test
   hel
   so
   po
   $ grep -Po '.*(?=lo)' test
   hello so
   po
   ~~~

   这是一种从右向左匹配，并且使用的贪婪模式。

2. 后发断言

   ~~~shell
   $ cat test
   helloa solox
   world
   love
   polo
   $ grep -Po '(?<=lo)[a-z]*' test
   a
   x
   ve
   $ grep -Po '(?<=lo).*' test
   a solox
   ve
   ~~~

   这是一种从左向右的匹配，并且也是贪婪匹配。

3. 负向零宽断言

   也是匹配一个零宽度的位置，不过这个位置的“断言”取表达式的反值。

   - 负向零宽后发断言

     (?!exp) 匹配后面跟的不是exp的位置

   - 负向零宽先行断言

     (?<!exp) 匹配前面不是exp的位置

   